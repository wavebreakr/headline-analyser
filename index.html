<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Readable</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f5f7fb;
    margin: 0;
    padding: 24px;
    color: #111;
  }

  .container {
    max-width: 820px;
    margin: auto;
    background: #fff;
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.05);
  }

  textarea {
    width: 100%;
    min-height: 170px;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #ddd;
    font-size: 16px;
    line-height: 1.6;
    resize: vertical;
  }

  button {
    margin-top: 12px;
    padding: 12px 18px;
    border-radius: 10px;
    border: none;
    background: #111;
    color: #fff;
    font-size: 15px;
    cursor: pointer;
  }

  .stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-top: 24px;
  }

  .box {
    background: #f7f9fc;
    padding: 16px;
    border-radius: 12px;
  }

  .label {
    font-size: 13px;
    color: #666;
  }

  .value {
    font-size: 17px;
    font-weight: 600;
  }

  .tag {
    display: inline-block;
    margin-left: 6px;
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
  }

  .excellent { background:#e6f7ec; color:#0b6b3a }
  .great { background:#eef6ff; color:#0b4ea2 }
  .good { background:#fff6e5; color:#8a5a00 }
  .difficult { background:#fdecec; color:#9a1c1c }

  .output {
    margin-top: 24px;
    padding: 16px;
    border-radius: 12px;
    background: #fafafa;
    border: 1px solid #eee;
  }

  .added {
    background: #d1fae5;
    padding: 2px 4px;
    border-radius: 4px;
  }
</style>
</head>

<body>
<div class="container">
  <h2>Readable</h2>
  <p>Make your writing easier to read â€” instantly.</p>

  <textarea id="input"></textarea>
  <button onclick="simplify()">Simplify</button>

  <div class="stats">
    <div class="box">
      <div class="label">Before</div>
      <div class="value" id="beforeStats"></div>
    </div>
    <div class="box">
      <div class="label">After</div>
      <div class="value" id="afterStats"></div>
    </div>
  </div>

  <div class="output" id="output"></div>
</div>

<script>
/* ==========================
   SIMPLIFICATION WORD BANK
   ========================== */

/* Phrases first (most impact) */
const phraseReplacements = {
  "in order to": "to",
  "due to the fact that": "because",
  "at this point in time": "now",
  "with regard to": "about",
  "in the event that": "if",
  "prior to": "before",
  "subsequent to": "after",
  "a significant number of": "many",
  "the majority of": "most",
  "has the ability to": "can",
  "is able to": "can",
  "in accordance with": "by",
  "for the purpose of": "to",
  "as a result of": "because",
  "in an effort to": "to",
  "it is important to note that": "note that",
  "plays a key role in": "helps",
  "take into consideration": "consider",
  "make a decision": "decide",
  "conduct an analysis": "analyze",
  "provide assistance": "help",
  "reach out to": "contact",
  "move forward with": "start",
  "has a tendency to": "often",
  "with the exception of": "except",
  "on a regular basis": "often",
  "in terms of": "about"
};

/* Single-word simplifications */
const wordReplacements = {
  "utilize": "use",
  "facilitate": "help",
  "implement": "start",
  "commence": "start",
  "terminate": "end",
  "sufficient": "enough",
  "numerous": "many",
  "objective": "goal",
  "demonstrate": "show",
  "assistance": "help",
  "individuals": "people",
  "organizations": "groups",
  "optimize": "improve",
  "evaluate": "review",
  "existing": "current",
  "approximately": "about",
  "subsequently": "later",
  "initially": "first",
  "ultimately": "finally",
  "regarding": "about",
  "therefore": "so",
  "however": "but",
  "moreover": "also",
  "additionally": "also",
  "nevertheless": "still",
  "sufficiently": "enough",
  "frequently": "often",
  "methodology": "method",
  "objective": "goal",
  "strategic": "planned",
  "leverage": "use",
  "impactful": "strong",
  "complexity": "difficulty",
  "modification": "change",
  "commonly": "often",
  "primarily": "mainly",
  "substantial": "large",
  "significant": "important",
  "demonstrates": "shows",
  "ensures": "makes sure",
  "attempt": "try",
  "obtain": "get",
  "require": "need",
  "retain": "keep",
  "assist": "help",
  "commence": "begin",
  "conclude": "end",
  "determine": "decide",
  "objective": "goal",
  "utilization": "use"
};

function simplifyText(text, level) {
  let simplified = text;

  // 1. Word replacements (already exists)
  const map = getActiveSimplifyMap(level);
  Object.keys(map).forEach(word => {
    const regex = new RegExp(`\\b${word}\\b`, "gi");
    simplified = simplified.replace(regex, map[word]);
  });

  // 2. Connector simplification
  simplified = simplified
    .replace(/\bwhich\b/gi, ".")
    .replace(/\bthat enable\b/gi, "help")
    .replace(/\bin order to\b/gi, "to")
    .replace(/\bdue to the fact that\b/gi, "because")
    .replace(/\bhowever\b/gi, "but");

  // 3. Sentence splitting
  simplified = splitLongSentences(simplified, level);

  // 4. Cleanup
  simplified = simplified.replace(/\s{2,}/g, " ").trim();

  return simplified;
}

function splitLongSentences(text, level) {
  const maxWords =
    level === 1 ? 20 :
    level === 2 ? 14 :
    10;

  return text
    .split(/([.!?])/)
    .reduce((acc, part, i, arr) => {
      if (i % 2 === 0) {
        const words = part.trim().split(" ");
        if (words.length > maxWords) {
          const midpoint = Math.ceil(words.length / 2);
          return acc + 
            words.slice(0, midpoint).join(" ") +
            ". " +
            words.slice(midpoint).join(" ");
        }
        return acc + part;
      }
      return acc + part;
    }, "");
}

/* ==========================
   METRICS
   ========================== */

function wordCount(text) {
  return text.trim() ? text.trim().split(/\s+/).length : 0;
}

function readingGrade(text) {
  const sentences = Math.max(1, text.split(/[.!?]+/).length);
  const words = Math.max(1, wordCount(text));
  const syllables = Math.max(1, text.split(/[aeiouy]+/gi).length);
  const score = 0.39 * (words / sentences) + 11.8 * (syllables / words) - 15.59;
  return Math.max(1, Math.round(score));
}

function gradeLabel(grade) {
  if (grade <= 6) return ["Excellent", "excellent"];
  if (grade <= 8) return ["Great", "great"];
  if (grade <= 10) return ["Good", "good"];
  return ["Difficult", "difficult"];
}

function diff(original, simplified) {
  const oWords = original.split(" ");
  const sWords = simplified.split(" ");
  return sWords.map(w =>
    oWords.includes(w) ? w : `<span class="added">${w}</span>`
  ).join(" ");
}

function simplify() {
  const input = document.getElementById("input").value;
  const simplified = simplifyText(input);

  const beforeWC = wordCount(input);
  const afterWC = wordCount(simplified);

  const beforeGrade = readingGrade(input);
  const afterGrade = readingGrade(simplified);

  const [bText, bClass] = gradeLabel(beforeGrade);
  const [aText, aClass] = gradeLabel(afterGrade);

  document.getElementById("beforeStats").innerHTML =
    `Words: ${beforeWC}<br>
     Reading level: Grade ${beforeGrade}
     <span class="tag ${bClass}">${bText}</span>`;

  document.getElementById("afterStats").innerHTML =
    `Words: ${afterWC}<br>
     Reading level: Grade ${afterGrade}
     <span class="tag ${aClass}">${aText}</span>`;

  document.getElementById("output").innerHTML = diff(input, simplified);
}
</script>
</body>
</html>