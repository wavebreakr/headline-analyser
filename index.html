<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultimate Language Simplifier</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    margin: 0; padding: 0; color: #333;
    background: linear-gradient(135deg, #e0f7fa 0%, #b3e5fc 100%);
    min-height: 100vh; display: flex; align-items: center; justify-content: center;
  }

  .container {
    max-width: 650px; width: 90%; margin: 32px auto; padding: 30px; border-radius: 20px;
    background: rgba(255, 255, 255, 0.25);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.4);
  }

  h2 { margin-top: 0; color: #1a237e; text-align: center; font-weight: 700; letter-spacing: -0.5px; }

  textarea {
    width: 100%; min-height: 180px; padding: 15px; font-size: 16px; line-height: 1.6;
    border-radius: 12px; box-sizing: border-box; font-family: inherit; resize: vertical;
    background: rgba(255, 255, 255, 0.7); border: 1px solid rgba(255, 255, 255, 0.5);
    transition: all 0.3s ease; margin-bottom: 10px; /* Reduced margin */
  }
  
  textarea:focus { background: white; outline: none; border-color: #42a5f5; }

  .action-area { margin: 20px 0 15px; } /* Adjusted margin */

  button {
    width: 100%; padding: 18px; font-size: 18px; font-weight: 700; border: none; border-radius: 12px;
    background: #1a237e; color: white; cursor: pointer;
    box-shadow: 0 4px 15px rgba(26, 35, 126, 0.3); transition: all 0.2s;
  }

  button:hover { background: #283593; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(26, 35, 126, 0.4); }

  #outputText { background: rgba(255, 255, 255, 0.5); font-weight: 500; }
  
  .stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 15px;
    font-size: 14px;
    text-align: center;
  }

  .stat {
    background: rgba(255, 255, 255, 0.5);
    padding: 12px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.5);
  }
  
  .stat strong { color: #1a237e; display: block; font-size: 16px; margin-bottom: 4px; }
  
  @media (max-width: 600px) {
    .stats { grid-template-columns: 1fr; }
  }
</style>
</head>

<body>
<div class="container">
  <h2>Simplifier</h2>

  <textarea id="inputText" placeholder="Paste complex text here..."></textarea>

  <div class="action-area">
    <button onclick="runSimplify()">Simplify Now</button>
  </div>

  <textarea id="outputText" readonly placeholder="Resulting simple text..."></textarea>
  
  <div class="stats">
    <div class="stat" id="beforeStats"></div>
    <div class="stat" id="afterStats"></div>
  </div>
</div>

<script>
// Dictionaries remain unchanged from the previous, most aggressive version
const phraseMap = {
  "in order to": "to", "prior to": "before", "subsequent to": "after", 
  "at this point in time": "now", "at that point in time": "then",
  "due to the fact that": "because", "owing to the fact that": "because", 
  "as a result of": "because", "with regard to": "about", 
  "in relation to": "about", "in respect of": "about",
  "endeavour to": "try to", "is capable of": "can",
  "has the ability to": "can", "has the capacity to": "can",
  "there is a need to": "we must", 
  "it is important to note that ": "", "it should be noted that ": "", 
  "the purpose of this is to ": "", "it has been determined that ": "",
  "make use of": "use", "conduct an evaluation": "check", 
  "take into consideration": "consider", "provides guidance for": "guides", 
  "give an indication of": "show", "in the event that": "if"
};

const wordMap = {
  "utilise": "use", "utilising": "using", "utilized": "used", "leverage": "use", 
  "implement": "use", "facilitate": "help", "commence": "start", 
  "commencing": "starting", "demonstrate": "show", "comprehensive": "full", 
  "numerous": "many", "significant": "big", "insufficient": "not enough", 
  "optimal": "best", "approximately": "about", "assistance": "help", 
  "prioritise": "focus on", "initially": "first", "ultimately": "lastly", 
  "methodology": "method", "objective": "goal", "discontinue": "stop", 
  "subsequently": "later", "consequently": "so", "regarding": "about",
  "ascertain": "check", "ameliorate": "fix", "delineate": "show", 
  "expeditiously": "fast", "individuals": "people", "organisations": "groups"
};

const conjunctionMap = {
  "furthermore": "Also", "moreover": "Also", "nevertheless": "But", 
  "however": "But", "therefore": "So", "hence": "So", "accordingly": "So"
};

/* ===========================
   CORE LOGIC & METRICS
=========================== */

function runSimplify() {
  const input = document.getElementById("inputText").value;
  let simplified = "";

  if(!input.trim()) {
    document.getElementById("outputText").value = "";
    updateStats("", "");
    return;
  }

  const simplifiedLines = input.split('\n').map(line => {
    if (line.trim().length === 0) return line;
    
    let out = simplifyLine(line);
    return cleanAndCapitalize(out);
  });

  simplified = simplifiedLines.join('\n');
  document.getElementById("outputText").value = simplified;
  
  // *** NEW: Update the stats block ***
  updateStats(input, simplified);
}

function simplifyLine(text) {
  let output = text;

  // STEP 1: Apply all substitutions
  output = applyReplacements(output, phraseMap);
  output = applyReplacements(output, wordMap);
  
  // STEP 2: Aggressive Conjunction Splitting
  for (const formal in conjunctionMap) {
    const regex = new RegExp(",\\s*" + formal + "\\s*", "gi");
    output = output.replace(regex, ". " + conjunctionMap[formal] + " ");
  }
  
  // STEP 3: Always split long connections
  output = output.replace(/; ([A-Z])/g, ". $1"); 
  output = output.replace(/, and /gi, ". "); 
  output = output.replace(/, but /gi, ". But ");
  
  return output;
}

function updateStats(originalText, simplifiedText) {
  const originalWordCount = wordCount(originalText);
  const simplifiedWordCount = wordCount(simplifiedText);
  
  let gradeHtml = ""; 
  // --- OPTIONAL READING LEVEL CODE ---
  /* const originalGrade = calculateGrade(originalText);
  const simplifiedGrade = calculateGrade(simplifiedText);
  gradeHtml = `<br>Grade Level: ${originalGrade} / ${simplifiedGrade}`;
  */
  // -----------------------------------

  document.getElementById("beforeStats").innerHTML = 
    `<strong>Original Text</strong>Words: ${originalWordCount}${gradeHtml}`;

  document.getElementById("afterStats").innerHTML = 
    `<strong>Simplified Text</strong>Words: ${simplifiedWordCount}${gradeHtml}`;
}

// ===================================
// UTILITY FUNCTIONS (Added Word Count)
// ===================================

function wordCount(text) {
  return text.trim().split(/\s+/).filter(Boolean).length;
}

// -----------------------------------
// COMMENTED OUT: Reading Grade functions (UNCOMMENT TO ENABLE GRADE LEVEL)
// -----------------------------------

/*
function calculateGrade(text) {
  const words = wordCount(text);
  const sentences = Math.max(text.split(/[.!?]/).length - 1, 1);
  const syllables = countSyllables(text);
  if (words === 0) return 0;
  const score = 0.39 * (words / sentences) + 11.8 * (syllables / words) - 15.59;
  return Math.max(0, Math.round(score * 10) / 10);
}

function countSyllables(text) {
  return text
    .toLowerCase()
    .split(/\s+/)
    .reduce((sum, word) => {
      word = word.replace(/[^a-z]/g, "");
      if (word.length <= 3) return sum + 1;
      const syllables = word.match(/[aeiouy]{1,2}/g);
      return sum + Math.max(1, (syllables ? syllables.length : 0));
    }, 0);
}
*/

// (Helper functions matchCase, applyReplacements, cleanAndCapitalize remain the same)

function applyReplacements(text, map) {
  let result = text;
  const keys = Object.keys(map).sort((a, b) => b.length - a.length);
  keys.forEach(key => {
    const useBoundary = key.split(" ").length === 1;
    const boundary = useBoundary ? "\\b" : "";
    const regex = new RegExp(boundary + key + boundary, "gi");
    result = result.replace(regex, (match) => {
      const rep = map[key];
      if (!rep) return "";
      if (match[0] === match[0].toUpperCase()) return rep.charAt(0).toUpperCase() + rep.slice(1);
      return rep.toLowerCase();
    });
  });
  return result;
}

function cleanAndCapitalize(text) {
  text = text.replace(/([.?!]\s*)[a-z]/g, (match, p1) => p1 + match.slice(-1).toUpperCase());
  if (text.trim().length > 0) text = text.trim().charAt(0).toUpperCase() + text.trim().slice(1);
  return text.replace(/\s+/g, " ").replace(/\s+\./g, ".").replace(/\.\./g, ".").replace(/\s+,/g, ",").trim();
}
</script>
</body>
</html>
