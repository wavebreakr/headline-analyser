<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Readable Text Analyzer</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f7f7f7;
      padding: 30px;
      max-width: 900px;
      margin: auto;
      color: #222;
    }

    textarea {
      width: 100%;
      min-height: 180px;
      padding: 14px;
      font-size: 16px;
      line-height: 1.5;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin: 12px 0;
      flex-wrap: wrap;
    }

    button, select {
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }

    .box {
      background: #fff;
      padding: 14px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .label {
      font-size: 13px;
      color: #666;
    }

    .value {
      font-size: 22px;
      font-weight: 600;
    }

    .tag {
      display: inline-block;
      margin-left: 8px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: #eee;
    }

    .excellent { background: #d1fae5; }
    .good { background: #e0f2fe; }
    .okay { background: #fef3c7; }
    .hard { background: #fee2e2; }

    .diff del {
      background: #fee2e2;
      text-decoration: line-through;
    }

    .diff ins {
      background: #d1fae5;
      text-decoration: none;
    }
  </style>
</head>
<body>

<h1>Readable Text Analyzer</h1>

<textarea id="inputText" placeholder="Paste your text here..."></textarea>

<div class="controls">
  <button onclick="runSimplify()">Simplify</button>
  <button onclick="runRewrite()">Rewrite</button>

  <select id="targetGrade">
    <option value="10">Target Grade: 10</option>
    <option value="8" selected>Target Grade: 8</option>
    <option value="6">Target Grade: 6</option>
  </select>
</div>

<div class="stats">
  <div class="box">
    <div class="label">Word count</div>
    <div class="value" id="wordCount">0 → 0</div>
  </div>

  <div class="box">
    <div class="label">Reading level</div>
    <div class="value" id="readingLevel">
      Grade 0 → 0 <span class="tag" id="readingTag"></span>
    </div>
  </div>
</div>

<h3>Preview (changes highlighted)</h3>
<div class="box diff" id="preview"></div>

<script>
/* ------------------------------
   Core metrics
------------------------------ */

function wordCount(text) {
  return text.trim() ? text.trim().split(/\s+/).length : 0;
}

function sentenceCount(text) {
  return text.split(/[.!?]+/).filter(Boolean).length || 1;
}

function syllableCount(word) {
  word = word.toLowerCase();
  if (word.length <= 3) return 1;
  word = word.replace(/(?:e$|es$|ed$)/, "");
  return word.match(/[aeiouy]{1,2}/g)?.length || 1;
}

function readingGrade(text) {
  const words = text.split(/\s+/).filter(Boolean);
  const sentences = sentenceCount(text);
  const syllables = words.reduce((sum, w) => sum + syllableCount(w), 0);
  return Math.max(
    0,
    Math.round(0.39 * (words.length / sentences) + 11.8 * (syllables / words.length) - 15.59)
  );
}

function readingLabel(grade) {
  if (grade <= 6) return ["Excellent", "excellent"];
  if (grade <= 9) return ["Good", "good"];
  if (grade <= 12) return ["Okay", "okay"];
  return ["Difficult", "hard"];
}

/* ------------------------------
   Simplification bank
------------------------------ */

const simplifyMap = {
  "utilize": "use",
  "implement": "start",
  "facilitate": "help",
  "approximately": "about",
  "subsequent": "next",
  "demonstrate": "show",
  "objective": "goal",
  "individuals": "people",
  "assistance": "help",
  "in order to": "to",
  "due to the fact that": "because",
  "prior to": "before",
  "at this point in time": "now",
  "commence": "start",
  "endeavour": "try",
  "sufficient": "enough",
  "numerous": "many",
  "leverage": "use",
  "strategic": "planned"
};

/* ------------------------------
   Rewrite logic
------------------------------ */

function simplifyText(text, target) {
  let output = text;
  for (const [complex, simple] of Object.entries(simplifyMap)) {
    output = output.replace(new RegExp(`\\b${complex}\\b`, "gi"), simple);
  }

  if (target <= 6) {
    output = output
      .replace(/, which|, that/gi, ".")
      .replace(/;|:/g, ".");
  }

  return output;
}

function rewriteText(text, target) {
  let sentences = text.split(/[.!?]+/).filter(Boolean);

  sentences = sentences.map(s => {
    s = s.trim();

    s = s.replace(/^In order to /i, "");
    s = s.replace(/It is important to note that /i, "");
    s = s.replace(/There are /i, "");

    if (target <= 6 && s.length > 80) {
      const mid = Math.floor(s.length / 2);
      return s.slice(0, mid) + ". " + s.slice(mid);
    }

    return s;
  });

  return sentences.join(". ") + ".";
}

/* ------------------------------
   Diff
------------------------------ */

function diffText(oldText, newText) {
  const oldWords = oldText.split(/\s+/);
  const newWords = newText.split(/\s+/);

  return newWords.map(w =>
    oldWords.includes(w) ? w : `<ins>${w}</ins>`
  ).join(" ");
}

/* ------------------------------
   Actions
------------------------------ */

function updateStats(before, after) {
  document.getElementById("wordCount").innerText =
    `${wordCount(before)} → ${wordCount(after)}`;

  const g1 = readingGrade(before);
  const g2 = readingGrade(after);

  const [label, cls] = readingLabel(g2);

  const tag = document.getElementById("readingTag");
  tag.textContent = label;
  tag.className = `tag ${cls}`;

  document.getElementById("readingLevel").innerHTML =
    `Grade ${g1} → ${g2} <span class="tag ${cls}">${label}</span>`;
}

function runSimplify() {
  const input = document.getElementById("inputText").value;
  const target = Number(document.getElementById("targetGrade").value);

  const output = simplifyText(input, target);

  document.getElementById("preview").innerHTML = diffText(input, output);
  updateStats(input, output);
}

function runRewrite() {
  const input = document.getElementById("inputText").value;
  const target = Number(document.getElementById("targetGrade").value);

  const output = rewriteText(input, target);

  document.getElementById("preview").innerHTML = diffText(input, output);
  updateStats(input, output);
}
</script>

</body>
</html>