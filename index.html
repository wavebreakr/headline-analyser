<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Readability + Smart Simplifier</title>
<style>
    body {
        font-family: sans-serif;
        padding: 30px;
        max-width: 860px;
        margin: auto;
        line-height: 1.5;
    }
    textarea {
        width: 100%;
        height: 160px;
        padding: 12px;
        font-size: 16px;
        border-radius: 6px;
    }
    .stats {
        margin-top: 20px;
        font-size: 15px;
    }
    .button-row {
        margin-top: 20px;
        display: flex;
        gap: 12px;
    }
    button {
        padding: 8px 14px;
        font-size: 15px;
        cursor: pointer;
        border-radius: 6px;
    }
    .diff-added {
        background: #d3ffd3;
        border-radius: 3px;
        padding: 1px 3px;
    }
    .diff-removed {
        background: #ffd6d6;
        text-decoration: line-through;
        border-radius: 3px;
        padding: 1px 3px;
    }
    .hidden {
        display: none;
    }
</style>
</head>
<body>

<h2>Real-Time Readability + Smart Simplifier</h2>

<textarea id="inputText" placeholder="Type or paste text…"></textarea>

<div class="button-row">
    <button id="simplifyBtn">One-Click Simplify</button>
    <button id="toggleDiffBtn" class="hidden">Show Original</button>
</div>

<div class="stats">
    <p><strong>Reading Grade Level:</strong> <span id="grade">—</span></p>
    <p><strong>Reading Ease:</strong> <span id="ease">—</span></p>
</div>

<h3>Simplified Output</h3>
<div id="output"></div>

<script>
/* ---------------------------------------------------------
   MASSIVE SMART SIMPLIFICATION DICTIONARY
--------------------------------------------------------- */
const simplifyMap = {
  "utilize":"use","utilises":"uses","utilization":"use",
  "leverage":"use","leverages":"uses",
  "regarding":"about","concerning":"about",
  "approximately":"about","approximate":"rough",
  "assistance":"help","assisting":"helping","assisted":"helped",
  "modification":"change","modifications":"changes",
  "implement":"use","implementation":"setup",
  "commence":"start","terminate":"end",
  "subsequent":"next","previously":"before",
  "in order to":"to","prior to":"before",
  "nevertheless":"still","nonetheless":"still",
  "consequently":"so","therefore":"so",
  "furthermore":"also","moreover":"also",
  "numerous":"many","sufficient":"enough",
  "insufficient":"not enough",
  "optimal":"best","facilitate":"help",
  "demonstrate":"show","indicate":"show","illustrate":"show",
  "comprehend":"understand","endeavour":"try","endeavor":"try",
  "acquire":"get","assure":"promise",
  "determine":"decide","collaborate":"work together",
  "component":"part","objective":"goal",
  "participate":"join","proceed":"go",
  "requirement":"need","capability":"ability",
  "substantial":"big","significant":"big",
  "extensive":"wide","ultimately":"finally",
  "fundamentally":"basically","initially":"first",
  "frequently":"often","occasionally":"sometimes",
  "significantly":"a lot","minimize":"reduce",
  "maximize":"increase","predominantly":"mostly",
  "individuals":"people","exceptionally":"very","extremely":"very"
};

/* ---------------------------------------------------------
   READABILITY (Flesch–Kincaid)
--------------------------------------------------------- */
function countSyllables(word) {
    word = word.toLowerCase();
    if (word.length <= 3) return 1;
    return (word.match(/[aeiouy]+/g) || []).length;
}

function computeReadability(text) {
    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
    if (sentences.length === 0) return { grade: 0, ease: 0 };

    const words = text.match(/\b[\w']+\b/g) || [];
    const syllables = words.reduce((a,w) => a + countSyllables(w), 0);

    const wordsPerSentence = words.length / sentences.length;
    const syllablesPerWord = syllables / words.length;

    const grade = (0.39 * wordsPerSentence) + (11.8 * syllablesPerWord) - 15.59;
    const ease = 206.835 - (1.015 * wordsPerSentence) - (84.6 * syllablesPerWord);

    return {
        grade: Math.max(0, Math.round(grade * 10) / 10),
        ease: Math.max(0, Math.round(ease * 10) / 10)
    };
}

/* ---------------------------------------------------------
   SMART SIMPLIFIER WITH DIFF HIGHLIGHTING
--------------------------------------------------------- */
function simplifyText(original) {
    let changedWords = [];

    // Sort long phrases first to avoid partial matches
    const keys = Object.keys(simplifyMap).sort((a,b)=>b.length-a.length);
    let simplified = original;

    keys.forEach(key => {
        const pattern = new RegExp("\\b" + key.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') + "\\b", "gi");
        simplified = simplified.replace(pattern, match => {
            const replacement = simplifyMap[key];
            changedWords.push({from: match, to: replacement});
            return replacement;
        });
    });

    return { simplified, changedWords };
}

function generateDiff(original, simplified, changes) {
    let diff = simplified;

    changes.forEach(change => {
        const escaped = change.to.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
        const pattern = new RegExp("\\b" + escaped + "\\b");
        diff = diff.replace(
            pattern,
            `<span class="diff-added">${change.to}</span>`
        );
    });

    return diff;
}

/* ---------------------------------------------------------
   DOM HANDLERS
--------------------------------------------------------- */
const input = document.getElementById("inputText");
const output = document.getElementById("output");
const gradeEl = document.getElementById("grade");
const easeEl = document.getElementById("ease");
const simplifyBtn = document.getElementById("simplifyBtn");
const toggleDiffBtn = document.getElementById("toggleDiffBtn");

let lastOriginal = "";
let lastSimplified = "";
let lastDiff = "";
let diffMode = true;

function updateStats() {
    const { grade, ease } = computeReadability(input.value);
    gradeEl.textContent = grade;
    easeEl.textContent = ease;
}

input.addEventListener("input", () => {
    lastOriginal = input.value;
    output.textContent = "";
    toggleDiffBtn.classList.add("hidden");
    updateStats();
});

simplifyBtn.addEventListener("click", () => {
    const { simplified, changedWords } = simplifyText(input.value);

    lastOriginal = input.value;
    lastSimplified = simplified;
    lastDiff = generateDiff(input.value, simplified, changedWords);

    diffMode = true;
    output.innerHTML = lastDiff;
    toggleDiffBtn.textContent = "Show Original";
    toggleDiffBtn.classList.remove("hidden");

    updateStats();
});

toggleDiffBtn.addEventListener("click", () => {
    diffMode = !diffMode;
    output.innerHTML = diffMode ? lastDiff : `<span>${lastOriginal}</span>`;
    toggleDiffBtn.textContent = diffMode ? "Show Original" : "Show Simplified";
});
</script>

</body>
</html>