<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultimate Language Simplifier (V1.2 Offline)</title>

<style>
  /* CORE STYLING */
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    margin: 0; padding: 0; color: #333;
    background: linear-gradient(135deg, #e0f7fa 0%, #b3e5fc 100%);
    min-height: 100vh; display: flex; align-items: center; justify-content: center;
  }

  .container {
    max-width: 700px; width: 90%; margin: 32px auto; padding: 30px; border-radius: 20px;
    background: rgba(255, 255, 255, 0.85);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.6);
  }

  h2 { margin-top: 0; color: #1565c0; text-align: center; font-weight: 800; letter-spacing: -0.5px; }

  .intro-text {
    background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 25px;
    border-left: 4px solid #1565c0; color: #0d47a1; line-height: 1.5; font-size: 15px;
  }

  textarea {
    width: 100%; min-height: 160px; padding: 15px; font-size: 16px; line-height: 1.6;
    border-radius: 12px; box-sizing: border-box; font-family: inherit; resize: vertical;
    background: #ffffff; border: 2px solid #e0e0e0;
    transition: border-color 0.2s; margin-bottom: 10px;
  }
  
  textarea:focus { outline: none; border-color: #2196f3; }
  textarea#outputText { background: #f5f5f5; color: #2c3e50; font-weight: 500; }

  button {
    width: 100%; padding: 16px; font-size: 18px; font-weight: 700; border: none; border-radius: 10px;
    background: #1565c0; color: white; cursor: pointer; margin-top: 5px; margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(21, 101, 192, 0.2); transition: background 0.2s, transform 0.1s;
  }

  button:hover { background: #0d47a1; transform: translateY(-1px); }
  button:active { transform: translateY(1px); }

  #copyButton {
    background: #009688; margin-top: 0; margin-bottom: 15px;
  }
  #copyButton:hover { background: #00796b; }
  
  .stat-row { display: flex; justify-content: space-between; font-size: 13px; color: #546e7a; font-weight: 600; margin-bottom: 5px; }
</style>
</head>

<body>
<div class="container">
  <h2>Plain English Converter (V1.2 Offline)</h2>

  <div class="intro-text">
      <strong>Reliability First.</strong> This is the self-contained version, guaranteed to work offline, with all known bugs fixed.
  </div>

  <div class="stat-row">
    <span id="originalWordCount">Words: 0</span>
  </div>
  <textarea id="inputText" placeholder="Paste complex text here (e.g. 'The Lessee shall endeavor to...')"></textarea>

  <button onclick="runSimplify()">Simplify Text</button>

  <div class="stat-row">
    <span id="simplifiedWordCount">Words: 0</span>
  </div>
  <textarea id="outputText" readonly placeholder="Simplified text will appear here..."></textarea>
  
  <button id="copyButton" onclick="copyToClipboard()">Copy Result</button>
</div>

<script>
// ==========================================
// 1. DICTIONARIES (Self-Contained)
// ==========================================

const phraseMap = {
    // CRITICAL GRAMMAR FIX: Targets the auxiliary verb to prevent "We are cannot"
    "We are not in a position to": "We cannot",
    "is not in a position to": "cannot",
    "are not in a position to": "cannot",
    
    // Test A Fixes
    "shall not be deemed acceptable": "is not allowed", 
    "is currently contingent upon": "depends on",
    "is predicated upon": "depends on", // Test B Fix

    // General Phrases
    "is hereby deemed a material breach of this agreement": "is a major break of this contract",
    "notwithstanding the provisions": "even with the rules",
    "The Lessee shall": "The renter must",
    "The Lessor shall": "The owner must",
    "is authorized to": "can",
    "in the event of": "if",
    "prior to": "before",
    "subsequent to": "after",
    "due to the fact that": "because",
    "it is important to note that ": "",
    "it should be noted that ": "",
    "make use of": "use",
    "conduct an evaluation": "check"
};

const wordMap = {
    // Test A & B Fixes
    "aforementioned": "this", 
    "irrefutable": "clear",
    "necessity": "need",
    "revision": "change",
    "protocols": "rules",
    "guidelines": "rules",
    "modification": "change",
    
    // General Words
    "shall": "must",
    "furnish": "give",
    "verification": "check",
    "commence": "start",
    "accrued": "earned",
    "transmit": "send",
    "said": "the",
    "rigorous": "strict",
    "expeditiously": "fast",
    "assistance": "help",
    "ultimately": "lastly",
    "methodology": "method",
    "objective": "goal",
    "consequently": "so",
    "ameliorate": "fix",
    "evaluation": "check",
    "establishment": "start"
};

const conjunctionMap = {
    "furthermore": "Also",
    "moreover": "Also",
    "nevertheless": "But",
    "however": "But",
    "therefore": "So",
    "hence": "So",
    "accordingly": "So"
};

// ==========================================
// 2. CORE FUNCTIONS (Refined for stability)
// ==========================================

function runSimplify() {
    const inputText = document.getElementById('inputText').value;
    document.getElementById('outputText').value = "";
    
    if (!inputText.trim().length) {
        updateStats("", "");
        return;
    }

    const simplifiedLines = inputText.split('\n').map(originalLine => {
        if (originalLine.trim().length === 0) {
            return originalLine;
        }

        let outputLine = originalLine;
        
        outputLine = applyReplacements(outputLine, phraseMap);
        outputLine = applyReplacements(outputLine, wordMap);
        outputLine = handleConjunctions(outputLine);
        outputLine = fixRedundancy(outputLine);
        outputLine = cleanAndCapitalize(outputLine);
        
        return outputLine;
    });

    const outputText = simplifiedLines.join('\n');
    document.getElementById('outputText').value = outputText;
    updateStats(inputText, outputText);
}


function handleConjunctions(line) {
    let result = line;
    for (const complex in conjunctionMap) {
        const simple = conjunctionMap[complex];
        // Matches comma, semicolon, or period followed by the conjunction
        const regex = new RegExp("[,;\\.]\\s*" + complex + "\\s*([\\.|,|\\s])", "gi");
        result = result.replace(regex, ". " + simple + ". ");
    }
    // Convert stray semicolons to periods
    result = result.replace(/; \s*([A-Z])/gi, ". $1"); 
    return result;
}

function fixRedundancy(line) {
    const weakAdverbs = ["most", "very", "highly", "thorough", "robust"];
    const absoluteAdjectives = ["best", "full", "complete", "unique", "strict", "major"];
    let result = line;

    weakAdverbs.forEach(adverb => {
        absoluteAdjectives.forEach(adjective => {
            // Replaces "very major" with just "major"
            const regex = new RegExp("\\b" + adverb + "\\s+" + adjective + "\\b", "gi");
            result = result.replace(regex, adjective);
        });
    });

    return result;
}

/**
 * V1.2 CRITICAL FIX: Robustly handles capitalization and trimming
 * without using complex, buggy slicing logic.
 */
function cleanAndCapitalize(line) {
    let cleaned = line.trim();
    
    // 1. Ensure sentence start capitalization (after period, question mark, or exclamation mark)
    // p1 = the punctuation and space (e.g., ". ")
    // match.charAt(match.length - 1) = the first lowercase letter after p1
    cleaned = cleaned.replace(/([.?!]\s*)[a-z]/gi, (match, p1) => p1 + match.charAt(match.length - 1).toUpperCase());

    // 2. Capitalize the very first letter of the entire line
    if (cleaned.length > 0) {
        // Find the index of the first letter (in case of leading spaces/symbols)
        const firstLetterIndex = cleaned.search(/[a-zA-Z]/);
        if (firstLetterIndex !== -1) {
            cleaned = cleaned.substring(0, firstLetterIndex) + 
                      cleaned.charAt(firstLetterIndex).toUpperCase() + 
                      cleaned.slice(firstLetterIndex + 1);
        }
    }
    
    // 3. General punctuation cleanup
    cleaned = cleaned.replace(/(\s+)/g, ' ')
                      .replace(/\s+\./g, '.')
                      .replace(/\.\./g, '.')
                      .replace(/\s+,/g, ',')
                      .trim();

    return cleaned;
}

// ==========================================
// 3. UTILITIES
// ==========================================

function copyToClipboard() {
    const outputTextarea = document.getElementById('outputText');
    if (outputTextarea.value.trim().length === 0) {
        alert("Nothing to copy!");
        return;
    }
    outputTextarea.select();
    document.execCommand('copy');
    
    const copyButton = document.getElementById('copyButton');
    const originalText = copyButton.innerText;
    copyButton.innerText = "Copied! ðŸŽ‰";
    
    setTimeout(() => {
        copyButton.innerText = originalText;
    }, 1500);
}

function updateStats(originalText, simplifiedText) {
    const originalCount = wordCount(originalText);
    const simplifiedCount = wordCount(simplifiedText);
    
    document.getElementById('originalWordCount').innerText = "Words: " + originalCount;
    document.getElementById('simplifiedWordCount').innerText = "Words: " + simplifiedCount;
}

function wordCount(text) {
    return text.trim().split(/\s+/).filter(Boolean).length;
}

function applyReplacements(text, map) {
    let result = text;
    // Sort keys by length descending to catch longer phrases first
    const sortedKeys = Object.keys(map).sort((a, b) => b.length - a.length);

    sortedKeys.forEach(complex => {
        const isSingleWord = complex.split(' ').length === 1;
        const boundary = isSingleWord ? "\\b" : "";
        
        const regex = new RegExp(boundary + complex + boundary, "gi");

        result = result.replace(regex, (match) => {
            const simple = map[complex];
            if (!simple) return ""; // Allows deletion of phrases

            // Preserve case: ALL CAPS -> ALL CAPS; Title Case -> Title Case
            if (match === match.toUpperCase()) return simple.toUpperCase();
            if (match[0] === match[0].toUpperCase()) {
                return simple.charAt(0).toUpperCase() + simple.slice(1).toLowerCase();
            }
            return simple.toLowerCase();
        });
    });
    return result;
}
</script>
</body>
</html>
