<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultimate Language Simplifier (NLP)</title>

<script src="https://unpkg.com/compromise@14.0.0/builds/compromise.min.js"></script>

<style>
  /* CORE STYLING (Kept clean and consistent) */
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    margin: 0; padding: 0; color: #333;
    background: linear-gradient(135deg, #e0f7fa 0%, #b3e5fc 100%);
    min-height: 100vh; display: flex; align-items: center; justify-content: center;
  }

  .container {
    max-width: 700px; width: 90%; margin: 32px auto; padding: 30px; border-radius: 20px;
    background: rgba(255, 255, 255, 0.85);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.6);
  }

  h2 { margin-top: 0; color: #1565c0; text-align: center; font-weight: 800; letter-spacing: -0.5px; }

  .intro-text {
    background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 25px;
    border-left: 4px solid #1565c0; color: #0d47a1; line-height: 1.5; font-size: 15px;
  }

  textarea {
    width: 100%; min-height: 160px; padding: 15px; font-size: 16px; line-height: 1.6;
    border-radius: 12px; box-sizing: border-box; font-family: inherit; resize: vertical;
    background: #ffffff; border: 2px solid #e0e0e0;
    transition: border-color 0.2s; margin-bottom: 10px;
  }
  
  textarea:focus { outline: none; border-color: #2196f3; }
  textarea#outputText { background: #f5f5f5; color: #2c3e50; font-weight: 500; }

  button {
    width: 100%; padding: 16px; font-size: 18px; font-weight: 700; border: none; border-radius: 10px;
    background: #1565c0; color: white; cursor: pointer; margin-top: 5px; margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(21, 101, 192, 0.2); transition: background 0.2s, transform 0.1s;
  }

  button:hover { background: #0d47a1; transform: translateY(-1px); }
  button:active { transform: translateY(1px); }

  #copyButton {
    background: #009688; margin-top: 0; margin-bottom: 15px;
  }
  #copyButton:hover { background: #00796b; }
  
  .stat-row { display: flex; justify-content: space-between; font-size: 13px; color: #546e7a; font-weight: 600; margin-bottom: 5px; }
</style>
</head>

<body>
<div class="container">
  <h2>Plain English Converter (V2.0 NLP)</h2>

  <div class="intro-text">
      <strong>New and improved.</strong> This version uses smarter Natural Language Processing to ensure better grammar and fix structural issues.
  </div>

  <div class="stat-row">
    <span id="originalWordCount">Words: 0</span>
  </div>
  <textarea id="inputText" placeholder="Paste complex text here (e.g. 'The Lessee shall endeavor to...')"></textarea>

  <button onclick="runSimplify()">Simplify Text</button>

  <div class="stat-row">
    <span id="simplifiedWordCount">Words: 0</span>
  </div>
  <textarea id="outputText" readonly placeholder="Simplified text will appear here..."></textarea>
  
  <button id="copyButton" onclick="copyToClipboard()">Copy Result</button>
</div>

<script>
// ==========================================
// 1. DICTIONARY & CONFIGURATION
// ==========================================

// This map uses 'tags' from compromise.js to target specific word types.
const smartReplacements = {
    // [TAGGED REPLACEMENTS]
    // Only replace the verb 'state', not the noun 'state' (like New York State)
    'state': { tag: '#Verb', replace: 'say' },
    'utilize': { tag: '#Verb', replace: 'use' },
    'terminate': { tag: '#Verb', replace: 'end' },
    'commence': { tag: '#Verb', replace: 'start' },
    'expedite': { tag: '#Verb', replace: 'speed up' },
    'facilitate': { tag: '#Verb', replace: 'help' },
    'ascertain': { tag: '#Verb', replace: 'check' },
    'demonstrate': { tag: '#Verb', replace: 'show' },
    'necessitate': { tag: '#Verb', replace: 'require' },
    'transmit': { tag: '#Verb', replace: 'send' },
    'furnish': { tag: '#Verb', replace: 'give' },
    'submit': { tag: '#Verb', replace: 'send' },
    'retain': { tag: '#Verb', replace: 'keep' },
    'procure': { tag: '#Verb', replace: 'buy' },
    'consult': { tag: '#Verb', replace: 'ask' },

    // [PHRASAL REPLACEMENTS] - Uses standard matching since it's hard to tag phrases
    'in the event of': 'if',
    'due to the fact that': 'because',
    'prior to the receipt of': 'before getting',
    'prior to': 'before',
    'subsequent to': 'after',
    'not later than': 'by',
    'at this point in time': 'now',
    'until such time as': 'until',
    'with reference to': 'about',
    'with regard to': 'about',
    'in respect of': 'about',
    'it is important to note that': '', // Deletion
    'it should be noted that': '',      // Deletion
    'The Lessee shall': 'The renter must',
    'The Lessee': 'The renter',
    'The Lessor shall': 'The owner must',
    'The Lessor': 'The owner',
    'shall endeavor to': 'will try to',
    'make use of': 'use',
    'is contingent upon': 'depends on',
    'is predicated upon': 'depends on',
    'notwithstanding': 'even with',
    'irrefutable': 'clear',
    'aforementioned': 'this',
    'said': 'the',
    'evaluation': 'check',
    'assessment': 'check'
};

const conjunctions = {
    "furthermore": "Also",
    "moreover": "Also",
    "nevertheless": "But",
    "however": "But",
    "therefore": "So",
    "hence": "So",
    "accordingly": "So"
};

// ==========================================
// 2. THE NLP ENGINE
// ==========================================

function runSimplify() {
    const input = document.getElementById('inputText').value;
    
    if (!input.trim()) {
        document.getElementById('outputText').value = "";
        updateStats(0, 0);
        return;
    }

    // 1. Load the text into the compromise NLP object
    let doc = nlp(input);

    // 2. Handle specific structural and grammatical improvements (CRITICAL FIXES)
    
    // Fix "We are not in a position to" -> "We cannot" (Grammar Fix)
    doc.match('(we|i|they|you) (are|am|is) not in a position to').replaceWith('$1 cannot');
    doc.match('not in a position to').replaceWith('cannot'); // General catch-all

    // Fix complex legal phrase: "shall not be deemed acceptable" -> "is not allowed"
    doc.match('(shall|will) not be deemed acceptable').replaceWith('is not allowed');
    
    // Remove Redundancy (Adverb/Adjective stripping)
    doc.match('(very|highly|extremely) #Adjective').replaceWith('$2');

    // 3. Apply Tagged Replacements
    for (const complex in smartReplacements) {
        const item = smartReplacements[complex];
        
        if (item.tag) { // Tagged word replacement
            doc.match(item.tag).match(complex).replaceWith(item.replace);
        } else { // Untagged phrase replacement
            doc.match(complex).replaceWith(item);
        }
    }

    // 4. Handle Conjunctions (Split complex sentence into two simple ones)
    Object.keys(conjunctions).forEach(conj => {
        const replacement = conjunctions[conj];
        doc.match(conj).replaceWith('. ' + replacement + '.');
    });

    // 5. Final Output Cleanup
    // Compromise handles sentence capitalization and spacing automatically using the .text() method.
    let result = doc.text();

    // Final string cleanup for any remaining punctuation weirdness
    result = result.replace(/\s+,/g, ',');
    result = result.replace(/\s+\./g, '.');
    result = result.replace(/\.\./g, '.');

    document.getElementById('outputText').value = result;
    updateStats(countWords(input), countWords(result));
}

// ==========================================
// 3. UTILITIES (Simplified)
// ==========================================

function countWords(str) {
    return str.trim().split(/\s+/).filter(n => n).length;
}

function updateStats(orig, simp) {
    document.getElementById('originalWordCount').innerText = `Words: ${orig}`;
    document.getElementById('simplifiedWordCount').innerText = `Words: ${simp}`;
}

function copyToClipboard() {
    const el = document.getElementById('outputText');
    if (!el.value) return;
    el.select();
    document.execCommand('copy');
    const btn = document.getElementById('copyButton');
    const oldText = btn.innerText;
    btn.innerText = "Copied! ðŸŽ‰";
    setTimeout(() => btn.innerText = oldText, 2000);
}
</script>
</body>
</html>
